<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.0.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="你只管努力、剩下的交给天意">
<meta property="og:type" content="website">
<meta property="og:title" content="sbing的博客">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="sbing的博客">
<meta property="og:description" content="你只管努力、剩下的交给天意">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="sbing的博客">
<meta name="twitter:description" content="你只管努力、剩下的交给天意">






  <link rel="canonical" href="http://yoursite.com/page/3/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>sbing的博客</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">sbing的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-首页">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-分类">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-标签">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-归档">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/07/JVM总体概述/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sbing">
      <meta itemprop="description" content="你只管努力、剩下的交给天意">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="sbing的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/07/JVM总体概述/" class="post-title-link" itemprop="url">jvm总体概述</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-07 17:01:21" itemprop="dateCreated datePublished" datetime="2019-02-07T17:01:21+08:00">2019-02-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-02 22:30:10" itemprop="dateModified" datetime="2019-03-02T22:30:10+08:00">2019-03-02</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/jvm/" itemprop="url" rel="index"><span itemprop="name">jvm</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>JVM屏蔽了与具体操作系统平台相关的信息</strong>，使 <code>Java</code>程序只需生成在 <code>Java</code>虚拟机上<strong>一次编译，多次运行，具有跨平台性</strong>。 <code>JVM</code>在执行字节码时，实际上最终还是把<strong>字节码</strong>解释成具体平台上的<strong>机器指令</strong>执行。</p>
<h1 id="类加载器（Class-Loader）"><a href="#类加载器（Class-Loader）" class="headerlink" title="类加载器（Class Loader）"></a>类加载器（Class Loader）</h1><p><strong>类加载器</strong> 负责加载程序中的类型（类和接口），并赋予唯一的名字予以标识。</p>
<p><img src="/img/jvm1.jpg" alt=""></p>
<p>类加载器的关系</p>
<ol>
<li><code>BootstrapClassloader</code> 是在 <code>Java</code>虚拟机启动后初始化的。</li>
<li><code>BootstrapClassloader</code> 负责加载 <code>ExtClassLoader</code>，并且将 <code>ExtClassLoader</code>的父加载器设置为 <code>BootstrapClassloader</code></li>
<li><code>BootstrapClassloader</code> 加载完 <code>ExtClassLoader</code> 后，就会加载 <code>AppClassLoader</code>，并且将 <code>AppClassLoader</code> 的父加载器指定为 <code>ExtClassLoader</code>。</li>
</ol>
<h1 id="双亲委托机制"><a href="#双亲委托机制" class="headerlink" title="双亲委托机制"></a>双亲委托机制</h1><p><code>Java</code>中 <code>ClassLoader</code>的加载采用了<strong>双亲委托机制</strong>，采用<strong>双亲委托机制</strong>加载类的时候采用如下的几个步骤：</p>
<ol>
<li>当前 <code>ClassLoader</code>首先从自己已经加载的类中查询是否此类已经加载，如果已经加载则直接返回原来已经加载的类。</li>
<li>当前 <code>ClassLoader</code>的缓存中没有找到被加载的类的时候，委托父类加载器去加载，父类加载器采用同样的策略，首先查看自己的缓存，然后委托父类的父类去加载，一直到 <code>BootstrapClassLoader</code>。</li>
<li>当所有的父类加载器都没有加载的时候，再由当前的类加载器加载，并将其放入它自己的缓存中，以便下次有加载请求的时候直接返回。</li>
</ol>
<blockquote>
<p><strong>小结</strong> ：双亲委托机制的核心思想分为两个步骤。其一，自底向上检查类是否已经加载；其二，自顶向下尝试加载类。</p>
</blockquote>
<h1 id="类装载器特点"><a href="#类装载器特点" class="headerlink" title="类装载器特点"></a>类装载器特点</h1><p><code>Java</code>提供了<strong>动态加载</strong>特性。在运行时的第一次引用到一个 <code>class</code>的时候会对它进行<strong>装载(Loading)</strong> 、 <strong>连接(Linking) 和 初始化(Initialization) *</strong>，而不是在编译时进行。不同的JVM的实现不同，本文所描述的内容均只限于 <code>HotspotJVM</code>。</p>
<p><code>JVM</code>的类装载器负责动态装载， <code>Java</code>的类装载器有如下几个特点：</p>
<ul>
<li><strong>层级结构</strong>：Java里的类装载器被组织成了有父子关系的层级结构。Bootstrap类装载器是所有装载器的父亲。</li>
<li><strong>代理模式</strong>： 基于层级结构，类的代理可以在装载器之间进行代理。当装载器装载一个类时，首先会检查它在父装载器中是否进行了装载。如果上层装载器已经装载了这个类，这个类会被直接使用。反之，类装载器会请求装载这个类</li>
<li><strong>可见性限制</strong>：一个子装载器可以查找父装载器中的类，但是一个父装载器不能查找子装载器里的类。</li>
<li><strong>不允许卸载</strong>：类装载器可以装载一个类但是不可以卸载它，不过可以删除当前的类装载器，然后创建一个新的类装载器装载。</li>
</ul>
<h1 id="类装载器过程"><a href="#类装载器过程" class="headerlink" title="类装载器过程"></a>类装载器过程</h1><p><strong>1）加载（Loading）</strong></p>
<p>首先，根据<strong>类的全限定名</strong>找到代表这个类的 <code>Class</code>文件，然后读取到一个<strong>字节数组</strong>中。接着，这些字节会被解析检验它们是否代表一个 <code>Class</code><strong>对象</strong>并包含正确的 <code>major</code>、 <code>minor</code>版本信息。<strong>直接父类</strong> 的类和接口也会被加载进来。这些操作一旦完成，<strong>类或者接口对象</strong> 就从二进制表示中创建出来了。</p>
<p><strong>2）连接（Linking）</strong></p>
<p>链接是检验类或接口并准备类型和父类接口的过程。链接过程包含三步：<strong>校验（Verifying）</strong>、<strong>准备（Preparing）</strong>、<strong>部分解析（Optionally resolving）</strong>。</p>
<ul>
<li><strong>验证</strong></li>
</ul>
<p>这是类装载中最复杂的过程，并且花费的时间也是最长的。任务是确保导入类型的<strong>准确性</strong>，验证阶段做的检查，运行时不需要再做。虽然减慢加了载速度，但是避免了多次检查。</p>
<ul>
<li><strong>准备</strong></li>
</ul>
<p>准备过程通常分配一个结构用来<strong>存储类信息</strong>，这个结构中包含了类中定义的<strong>成员变量</strong>，<strong>方法</strong> 和<strong>接口信息</strong>等。</p>
<ul>
<li><strong>解析</strong></li>
</ul>
<p>解析是可选阶段，把这个类的<strong>常量池</strong>中的所有的<strong>符号引用</strong>改变成<strong>直接引用</strong>。如果不执行，符号解析要等到字节码指令使用这个引用时才会进行。</p>
<p><strong>3）初始化（Initialization）</strong></p>
<p>把类中的变量初始化成合适的值。执行<strong>静态初始化程序</strong>，把<strong>静态变量</strong>初始化成指定的值。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/05/jvm常见垃圾回收器/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sbing">
      <meta itemprop="description" content="你只管努力、剩下的交给天意">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="sbing的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/05/jvm常见垃圾回收器/" class="post-title-link" itemprop="url">jvm常见垃圾回收器</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-05 17:01:21" itemprop="dateCreated datePublished" datetime="2019-02-05T17:01:21+08:00">2019-02-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-03 16:48:42" itemprop="dateModified" datetime="2019-03-03T16:48:42+08:00">2019-03-03</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/jvm/" itemprop="url" rel="index"><span itemprop="name">jvm</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="七种垃圾回收器概述"><a href="#七种垃圾回收器概述" class="headerlink" title="七种垃圾回收器概述"></a>七种垃圾回收器概述</h1><p>在 <code>JVM</code> 中，具体实现有 <code>Serial</code>、 <code>ParNew</code>、 <code>ParallelScavenge</code>、 <code>CMS</code>、 <code>SerialOld（MSC）</code>、 <code>ParallelOld</code>、 <code>G1</code> 等。</p>
<p>如果当 <strong>垃圾回收器</strong> 进行垃圾清理时，必须 <strong>暂停</strong> 其他所有的 <strong>工作线程</strong>，直到它完全收集结束。我们称这种需要暂停工作线程才能进行清理的策略为 <code>Stop-the-World</code>。以上回收器中， <code>Serial</code>、 <code>ParNew</code>、 <code>ParallelScavenge</code>、 <code>SerialOld</code>、 <code>ParallelOld</code> 均采用的是 <code>Stop-the-World</code> 的策略。</p>
<p>图中有 <code>7</code> 种不同的 <strong>垃圾回收器</strong>，它们分别用于不同分代的垃圾回收。</p>
<ul>
<li><strong>新生代回收器</strong>：Serial、ParNew、Parallel Scavenge</li>
<li><strong>老年代回收器</strong>：Serial Old、Parallel Old、CMS</li>
<li><strong>整堆回收器</strong>：G1</li>
</ul>
<h1 id="单线程垃圾回收器"><a href="#单线程垃圾回收器" class="headerlink" title="单线程垃圾回收器"></a>单线程垃圾回收器</h1><h2 id="Serial（-XX-UseSerialGC）"><a href="#Serial（-XX-UseSerialGC）" class="headerlink" title="Serial（-XX:+UseSerialGC）"></a>Serial（-XX:+UseSerialGC）</h2><p><code>Serial</code> 回收器是最基本的 <strong>新生代</strong> 垃圾回收器，是 <strong>单线程</strong> 的垃圾回收器。由于垃圾清理时， <code>Serial</code> <strong>回收器</strong> 不存在 <strong>线程间的切换</strong>，因此，特别是在单 <code>CPU</code> 的环境下，它的 <strong>垃圾清除效率</strong> 比较高。对于 <code>Client</code> 运行模式的程序，选择 <code>Serial</code> 回收器是一个不错的选择。</p>
<p><code>Serial</code> <strong>新生代回收器</strong> 采用的是 <strong>复制算法</strong>。</p>
<h2 id="Serial-Old（-XX-UseSerialGC）"><a href="#Serial-Old（-XX-UseSerialGC）" class="headerlink" title="Serial Old（-XX:+UseSerialGC）"></a>Serial Old（-XX:+UseSerialGC）</h2><p><code>SerialOld</code> 回收器是 <code>Serial</code> 回收器的 <strong>老生代版本</strong>，属于 <strong>单线程回收器</strong>，它使用 <strong>标记-整理</strong> 算法。对于 <code>Server</code> 模式下的虚拟机，在 <code>JDK1.5</code> 及其以前，它常与 <code>ParallelScavenge</code> 回收器配合使用，达到较好的 <strong>吞吐量</strong>，另外它也是 <code>CMS</code>回收器在 <code>ConcurrentModeFailure</code> 时的 <strong>后备方案</strong>。</p>
<p><code>Serial</code> 回收器和 <code>SerialOld</code> 回收器的执行效果如下：</p>
<blockquote>
<p><code>SerialOld</code> <strong>老年代回收器</strong> 采用的是 <strong>标记 - 整理算法</strong>。</p>
</blockquote>
<h1 id="多线程垃圾回收器"><a href="#多线程垃圾回收器" class="headerlink" title="多线程垃圾回收器"></a>多线程垃圾回收器</h1><h2 id="ParNew（-XX-UseParNewGC）"><a href="#ParNew（-XX-UseParNewGC）" class="headerlink" title="ParNew（-XX:+UseParNewGC）"></a>ParNew（-XX:+UseParNewGC）</h2><p><code>ParNew</code> 回收器是在 <code>Serial</code> 回收器的基础上演化而来的，属于 <code>Serial</code> 回收器的 <strong>多线程版本</strong>，同样运行在 <strong>新生代区域</strong>。在实现上，两者共用很多代码。在不同运行环境下，根据 <code>CPU</code> 核数，开启 <strong>不同的线程数</strong>，从而达到 <strong>最优</strong> 的垃圾回收效果。对于那些 <code>Server</code> 模式的应用程序，如果考虑采用 <code>CMS</code> 作为 <strong>老生代回收器</strong>时， <code>ParNew</code> 回收器是一个不错的选择。</p>
<blockquote>
<p><code>ParNew</code> <strong>新生代回收器</strong> 采用的是 <strong>复制算法</strong>。</p>
</blockquote>
<h2 id="Parallel-Scavenge（-XX-UseParallelGC）"><a href="#Parallel-Scavenge（-XX-UseParallelGC）" class="headerlink" title="Parallel Scavenge（-XX:+UseParallelGC）"></a>Parallel Scavenge（-XX:+UseParallelGC）</h2><p>和 <code>ParNew</code> 回收一样， <code>ParallelScavenge</code> 回收器也是运行在 <strong>新生代区域</strong>，属于 <strong>多线程</strong> 的回收器。但不同的是， <code>ParNew</code> 回收器是通过控制 <strong>垃圾回收</strong> 的 <strong>线程数</strong>来进行参数调整，而 <code>ParallelScavenge</code> 回收器更关心的是 <strong>程序运行的吞吐量</strong>。即一段时间内，<strong>用户代码</strong> 运行时间占 <strong>总运行时间</strong> 的百分比。</p>
<blockquote>
<p><code>ParallelScavenge</code> <strong>新生代回收器</strong> 采用的是 <strong>复制算法</strong>。</p>
</blockquote>
<h2 id="Parallel-Old（-XX-UseParallelOldGC）"><a href="#Parallel-Old（-XX-UseParallelOldGC）" class="headerlink" title="Parallel Old（-XX:+UseParallelOldGC）"></a>Parallel Old（-XX:+UseParallelOldGC）</h2><p><code>ParallelOld</code> 回收器是 <code>ParallelScavenge</code> 回收器的 <strong>老生代版本</strong>，属于 <strong>多线程回收器</strong>，采用 <strong>标记-整理算法</strong>。 <code>ParallelOld</code> 回收器和 <code>ParallelScavenge</code>回收器同样考虑了 <strong>吞吐量优先</strong> 这一指标，非常适合那些 <strong>注重吞吐量</strong> 和 <code>CPU</code> <strong>资源敏感</strong>的场合。</p>
<blockquote>
<p><code>ParallelOld</code> <strong>老年代回收器</strong> 采用的是 <strong>标记 - 整理算法</strong>。</p>
</blockquote>
<h1 id="其他的回收器"><a href="#其他的回收器" class="headerlink" title="其他的回收器"></a>其他的回收器</h1><h2 id="CMS（-XX-UseConcMarkSweepGC）"><a href="#CMS（-XX-UseConcMarkSweepGC）" class="headerlink" title="CMS（-XX:+UseConcMarkSweepGC）"></a>CMS（-XX:+UseConcMarkSweepGC）</h2><p><code>CMS（ConcurrentMarkSweep）</code> 回收器是在 <strong>最短回收停顿时间</strong> 为前提的回收器，属于 <strong>多线程回收器</strong>，采用 <strong>标记-清除算法</strong>。</p>
<h2 id="G1回收器（垃圾区域Region优先）"><a href="#G1回收器（垃圾区域Region优先）" class="headerlink" title="G1回收器（垃圾区域Region优先）"></a>G1回收器（垃圾区域Region优先）</h2><p><code>G1</code> 是 <code>JDK1.7</code> 中正式投入使用的用于取代 <code>CMS</code> 的 <strong>压缩回收器</strong>。它虽然没有在物理上隔断 <strong>新生代</strong> 与 <strong>老生代</strong>，但是仍然属于 <strong>分代垃圾回收器</strong>。 <code>G1</code> 仍然会区分 <strong>年轻代</strong> 与 <strong>老年代</strong>，年轻代依然分有 <code>Eden</code> 区与 <code>Survivor</code> 区。</p>
<p><code>G1</code> 首先将 <strong>堆</strong> 分为 <strong>大小相等</strong> 的 <code>Region</code>，避免 <strong>全区域</strong> 的垃圾回收。然后追踪每个 <code>Region</code> 垃圾 <strong>堆积的价值大小</strong>，在后台维护一个 <strong>优先列表</strong>，根据允许的回收时间优先回收价值最大的 <code>Region</code>。同时 <code>G1</code>采用 <code>RememberedSet</code> 来存放 <code>Region</code>之间的 <strong>对象引用</strong> ，其他回收器中的 <strong>新生代</strong> 与 <strong>老年代</strong> 之间的对象引用，从而避免 <strong>全堆扫描</strong>。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/25/Java实现二叉树/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sbing">
      <meta itemprop="description" content="你只管努力、剩下的交给天意">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="sbing的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/25/Java实现二叉树/" class="post-title-link" itemprop="url">java实现二叉树</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-01-25 17:01:21" itemprop="dateCreated datePublished" datetime="2019-01-25T17:01:21+08:00">2019-01-25</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-06-27 21:30:12" itemprop="dateModified" datetime="2019-06-27T21:30:12+08:00">2019-06-27</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/数据结构与算法/" itemprop="url" rel="index"><span itemprop="name">数据结构与算法</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBiTree</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Node root;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span></span>&#123;</span><br><span class="line">        <span class="keyword">char</span> data;</span><br><span class="line">        Node left;</span><br><span class="line">        Node right;</span><br><span class="line">        Node(<span class="keyword">char</span> data)&#123;</span><br><span class="line">            <span class="keyword">this</span>.data = data;</span><br><span class="line">            left = <span class="keyword">null</span>;</span><br><span class="line">            right = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h1><h2 id="前中序列构建二叉树"><a href="#前中序列构建二叉树" class="headerlink" title="前中序列构建二叉树"></a>前中序列构建二叉树</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// 根据 前 中 序列 构建二叉树</span><br><span class="line">    public Node build(String preOrder,String inOrder)&#123;</span><br><span class="line">        if(preOrder.isEmpty())</span><br><span class="line">            return null;</span><br><span class="line">        char rootValue = preOrder.charAt(0);</span><br><span class="line">        int rootIndex = inOrder.indexOf(rootValue);</span><br><span class="line"></span><br><span class="line">        Node root = new Node(rootValue);</span><br><span class="line">        root.left = build(</span><br><span class="line">                preOrder.substring(1,1+rootIndex),</span><br><span class="line">                inOrder.substring(0,rootIndex)</span><br><span class="line">        );</span><br><span class="line">        root.right = build(</span><br><span class="line">              preOrder.substring(1+rootIndex),</span><br><span class="line">              inOrder.substring(1+rootIndex)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        return root;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="递归前序遍历"><a href="#递归前序遍历" class="headerlink" title="递归前序遍历"></a>递归前序遍历</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public void preOrder(Node root)&#123;</span><br><span class="line">        if(root != null)&#123;</span><br><span class="line">            System.out.print(root.data+&quot; &quot;);</span><br><span class="line">            preOrder(root.left);</span><br><span class="line">            preOrder(root.right);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="递归后续遍历"><a href="#递归后续遍历" class="headerlink" title="递归后续遍历"></a>递归后续遍历</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public void afterOrder(Node root)&#123;</span><br><span class="line">        if(root != null)&#123;</span><br><span class="line">            afterOrder(root.left);</span><br><span class="line">            afterOrder(root.right);</span><br><span class="line">            System.out.print(root.data+&quot; &quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/23/java实现循环队列/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sbing">
      <meta itemprop="description" content="你只管努力、剩下的交给天意">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="sbing的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/23/java实现循环队列/" class="post-title-link" itemprop="url">java实现循环队列</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-01-23 17:01:21" itemprop="dateCreated datePublished" datetime="2019-01-23T17:01:21+08:00">2019-01-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-06-27 21:30:05" itemprop="dateModified" datetime="2019-06-27T21:30:05+08:00">2019-06-27</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/数据结构与算法/" itemprop="url" rel="index"><span itemprop="name">数据结构与算法</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这里给出用数组实现的循环队列。采用牺牲一个单元格的方式判断队列满</p>
<h1 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyQueue</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] data;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> front;<span class="comment">//头 删</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> rear;<span class="comment">//尾 插</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> max;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyQueue</span><span class="params">(<span class="keyword">int</span> max)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.max = max;</span><br><span class="line">        data = <span class="keyword">new</span> <span class="keyword">int</span>[max];</span><br><span class="line">        front = <span class="number">0</span>;</span><br><span class="line">        rear = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h1><h2 id="入队"><a href="#入队" class="headerlink" title="入队"></a>入队</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 入队 从rear入队</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">enQueue</span><span class="params">(<span class="keyword">int</span> value)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 判断队列是否已满  采用牺牲单元格的做法</span></span><br><span class="line">        <span class="keyword">if</span>((rear+<span class="number">1</span>)%max == front)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"队列满"</span>);</span><br><span class="line">        data[rear] = value;</span><br><span class="line">        rear = (rear+<span class="number">1</span>)%max;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="出队"><a href="#出队" class="headerlink" title="出队"></a>出队</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 出队</span><br><span class="line">    public int deQueue()&#123;</span><br><span class="line">        // 队列为空 不能出队</span><br><span class="line">        if(front == rear)</span><br><span class="line">            throw new RuntimeException(&quot;队列空&quot;);</span><br><span class="line">        int value = data[front];</span><br><span class="line">        front = (front+1)%max;</span><br><span class="line">        return value;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/22/java实现栈/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sbing">
      <meta itemprop="description" content="你只管努力、剩下的交给天意">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="sbing的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/22/java实现栈/" class="post-title-link" itemprop="url">java实现栈</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-01-22 17:01:21" itemprop="dateCreated datePublished" datetime="2019-01-22T17:01:21+08:00">2019-01-22</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-06-27 21:29:58" itemprop="dateModified" datetime="2019-06-27T21:29:58+08:00">2019-06-27</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/数据结构与算法/" itemprop="url" rel="index"><span itemprop="name">数据结构与算法</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>java实现栈、用数组实现。主要还是给出常规的操作</p>
<h1 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyStack</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> top;<span class="comment">//栈顶指针</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> max;<span class="comment">//栈的最大容量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] data;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyStack</span><span class="params">(<span class="keyword">int</span> max)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.max = max;</span><br><span class="line">        data = <span class="keyword">new</span> <span class="keyword">int</span>[max];</span><br><span class="line">        top = -<span class="number">1</span>; <span class="comment">// 初始化为 -1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h1><h2 id="入栈"><a href="#入栈" class="headerlink" title="入栈"></a>入栈</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 入栈</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> value)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 栈不满 就可以入栈</span></span><br><span class="line">        <span class="keyword">if</span>(top == max-<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"栈已满"</span>);</span><br><span class="line">        data[++top] = value;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="出栈"><a href="#出栈" class="headerlink" title="出栈"></a>出栈</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 出栈</span><br><span class="line">    public int pop()&#123;</span><br><span class="line">        if(top == -1)</span><br><span class="line">            throw new RuntimeException(&quot;栈为空&quot;);</span><br><span class="line">        return data[top--];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/04/熔断器Hystrix/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sbing">
      <meta itemprop="description" content="你只管努力、剩下的交给天意">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="sbing的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/04/熔断器Hystrix/" class="post-title-link" itemprop="url">熔断器Hystrix</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-01-04 17:01:21" itemprop="dateCreated datePublished" datetime="2019-01-04T17:01:21+08:00">2019-01-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-02 11:15:36" itemprop="dateModified" datetime="2019-03-02T11:15:36+08:00">2019-03-02</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/springcloud/" itemprop="url" rel="index"><span itemprop="name">springcloud</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在微服务框架 <code>SpringCloud</code> 中，可以用 <code>RestTemplate</code> 配合 <code>Ribbon</code> 或 <code>Feign</code>实现 <strong>服务与服务</strong> 之间的 <strong>相互调用</strong>。</p>
<p>为了保证服务的 <strong>高可用</strong>，<strong>单个服务</strong> 通常会采用 <strong>集群部署</strong>。由于 <strong>网络原因</strong>，服务并不能保证 <code>100%</code> 的 <strong>可用性</strong>，如果 <strong>单个服务</strong> 出现问题，调用这个服务就会出现 <strong>线程阻塞</strong>，此时若有 <strong>大量的请求</strong>涌入， <code>Servlet</code> 容器的 <strong>线程资源</strong> 会被耗尽，导致 <strong>服务瘫痪</strong>。</p>
<p>服务与服务之间具有 <strong>依赖性</strong>，故障会传播，导致整个微服务系统发生 <strong>雪崩</strong>。</p>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><p><code>Netflix</code> 开源了 <code>Hystrix</code> 组件，实现了 <strong>熔断器模式</strong>， <code>SpringCloud</code> 对这个组件进行了整合。在微服务架构中，一个请求需要调用 <strong>多个服务</strong> 是非常常见的，如下图所示：</p>
<p><img src="/img/hystrix1.jpg" alt=""></p>
<p><strong>下层</strong> 的服务如果出现故障，会导致 <strong>故障级联效应</strong>。当对特定的服务的调用的 <strong>失败次数</strong> 达到一个 <strong>阀值</strong>（ <code>Hystrix</code> 是 <code>5</code> 秒 <code>20</code> 次），<strong>断路器</strong> 将会被打开。</p>
<p><img src="/img/hystrix2.jpg" alt=""></p>
<p><strong>断路器</strong> 打开后 <strong>底层服务</strong> 将会隔断，可用避免 <strong>故障级联</strong> 问题，<strong>上层服务</strong> 调用 <code>fallback</code> 方法直接返回一个 <strong>固定值</strong>。</p>
<h2 id="在Ribbon上使用熔断器"><a href="#在Ribbon上使用熔断器" class="headerlink" title="在Ribbon上使用熔断器"></a>在Ribbon上使用熔断器</h2><p>在 <code>pom.xml</code> 文件中引入 <code>hystrix</code> 的 <strong>起步依赖</strong> <code>spring-cloud-starter-hystrix</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-cloud-starter-hystrix&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>在应用的启动类上使用 <code>@EnableHystrix</code> 开启 <code>hystrix</code> 的功能。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@EnableHystrix</span><br><span class="line">@EnableDiscoveryClient</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class ServiceRibbonApplication &#123;</span><br><span class="line">  </span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		SpringApplication.run(ServiceRibbonApplication.class, args);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">	@Bean   </span><br><span class="line">	@LoadBalanced   </span><br><span class="line">	public RestTemplate restTemplate () &#123;   </span><br><span class="line">		return new RestTemplate ();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用注解 <code>@HystrixCommand</code> 标记调用失败时需要熔断的方法， <code>fallbackMethod</code>属性指定 <strong>降级方法</strong> 的 <strong>方法名</strong> 为 <code>fallback</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@Service</span><br><span class="line">public class HelloService &#123;</span><br><span class="line">  </span><br><span class="line">	@Autowired</span><br><span class="line">	private RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">	@HystrixCommand(fallbackMethod = &quot;fallback&quot;)</span><br><span class="line">    public String requestForHiService(String name)&#123;   </span><br><span class="line">		return restTemplate.getForObject(&quot;http://SERVICE-HI/hi?name=&quot; + name, String.class);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">	public String fallback(String name)&#123;   </span><br><span class="line">		return &quot;Fallback method invoked, name is &quot; + name;</span><br><span class="line">    </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="在Feign上使用熔断器"><a href="#在Feign上使用熔断器" class="headerlink" title="在Feign上使用熔断器"></a>在Feign上使用熔断器</h2><p><code>Feign</code> 是自带 <strong>断路器</strong> 的，不过需要在 <strong>配置文件</strong> 中开启 <code>hystrix</code> 的配置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">feign:</span><br><span class="line">  hystrix:</span><br><span class="line">    enabled: true</span><br></pre></td></tr></table></figure>
<p><code>Hystrix</code> 支持 <strong>降级回退</strong> 操作，当 <strong>发生熔断</strong> 或 <strong>出现错误</strong> 时，调用会执行 <strong>默认代码路径</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@FeignClient(value = &quot;service-hi&quot;, fallback = HelloServiceFallback.class)</span><br><span class="line">public interface HelloService &#123;</span><br><span class="line">	@RequestMapping(value = &quot;/hi&quot;, method = RequestMethod.GET)</span><br><span class="line">	String sayHi(@RequestParam(value = &quot;name&quot;) String name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过设置 <code>fallback</code> 属性为实现 <strong>降级回退</strong> 的 <strong>类</strong>，来启用 <code>@FeignClient</code> 的 <strong>失败降级</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Service</span><br><span class="line">public class HelloServiceFallback implements HelloService &#123;</span><br><span class="line">   </span><br><span class="line">	@Override</span><br><span class="line">	public String sayHi (String name) &#123;   </span><br><span class="line">		return &quot;Fallback method invoked, name is &quot; + name;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果需要获取导致 <strong>回退触发</strong> 的原因，可以指定 <code>@FeignClient</code> 注解内部的 <code>fallbackFactory</code> 属性， <code>fallbackFactory</code> 属性和 <code>fallback</code> 属性不能一起使用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@FeignClient(value = &quot;service-hi&quot;, fallbackFactory = HelloServiceFallbackFactory.class)</span><br><span class="line">public interface HelloService &#123;</span><br><span class="line">	@RequestMapping(value = &quot;/hi&quot;,method = RequestMethod.GET) </span><br><span class="line">	String sayHi(@RequestParam(value = &quot;name&quot;) String name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后提供一个 <code>FallbackFactory</code> 的 <strong>实现类</strong>，实现类指定 <strong>泛型参数</strong> 为 <code>HelloService</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class HelloServiceFallbackFactory implements FallbackFactory&lt;HelloService&gt; &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">    public HelloService create(Throwable throwable) &#123;   </span><br><span class="line">		return new HelloService() &#123;    </span><br><span class="line">			@Override</span><br><span class="line">			public String sayHi(String name) &#123;</span><br><span class="line">				return &quot;Fallback method invoked, name is &quot;</span><br><span class="line">                         + name +&quot;, message is &quot;+ throwable.getMessage();</span><br><span class="line">            </span><br><span class="line">			&#125;</span><br><span class="line">        </span><br><span class="line">		&#125;;</span><br><span class="line">    </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/03/feign/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sbing">
      <meta itemprop="description" content="你只管努力、剩下的交给天意">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="sbing的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/03/feign/" class="post-title-link" itemprop="url">feign</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-01-03 17:01:21" itemprop="dateCreated datePublished" datetime="2019-01-03T17:01:21+08:00">2019-01-03</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-02 10:48:48" itemprop="dateModified" datetime="2019-03-02T10:48:48+08:00">2019-03-02</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/springcloud/" itemprop="url" rel="index"><span itemprop="name">springcloud</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><code>Feign</code>是一个 <strong>声明式</strong>的 <code>HTTP</code> <strong>伪客户端</strong>，提供 <strong>面向接口</strong> 的 <code>HTTP</code> <strong>客户端调用</strong> 编程。通过 <code>Feign</code> 去消费服务。</p>
<p><code>Feign</code> 只需要创建一个 <strong>接口</strong> 并提供 <strong>注解</strong> 即可调用。</p>
<p><code>Feign</code> 具有 <strong>可插拔</strong> 的注解特性，可使用 <code>Feign</code> <strong>注解</strong> 和 <code>JAX-RS</code> <strong>注解</strong>。</p>
<p><code>Feign</code> 默认集成了 <code>Ribbon</code>，可以和 <code>Eureka</code> 结合使用，默认实现了 <strong>负载均衡</strong> 的效果。</p>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h2 id="创建服务提供者公用模块"><a href="#创建服务提供者公用模块" class="headerlink" title="创建服务提供者公用模块"></a>创建服务提供者公用模块</h2><p>创建一个 <code>user-parent</code> 的项目 <code>Module</code> <code>user-common</code> ，创建完成后 <code>pom.xml</code> 如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">	&lt;artifactId&gt;user-parent&lt;/artifactId&gt;</span><br><span class="line">    &lt;groupId&gt;com.bsong&lt;/groupId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">&lt;/parent&gt;</span><br><span class="line">&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line">&lt;artifactId&gt;user-common&lt;/artifactId&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-feign&lt;/artifactId&gt;</span><br><span class="line">    &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p><code>user-common</code> 定义了提供给别的系统的所有行为，是一个使用 <code>@FeignClient</code> 注解标记的 <strong>声明式服务接口</strong>。其中， <code>@FeignClient</code> 的 <code>value</code> 指定的是 <strong>服务提供者</strong> 的 <strong>服务名称</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@FeignClient(name = &quot;user-web-server&quot;, path = &quot;/us/rpc/user&quot;)</span><br><span class="line">public interface UserRpcService &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据用户id查询用户信息</span><br><span class="line">     *</span><br><span class="line">     * @param uid</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @GetMapping(value = &quot;/&#123;uid&#125;&quot;, produces = MediaType.APPLICATION_JSON_UTF8_VALUE)</span><br><span class="line">    User findById(@PathVariable(name = &quot;uid&quot;, required = false) String uid);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="创建服务提供者实现模块"><a href="#创建服务提供者实现模块" class="headerlink" title="创建服务提供者实现模块"></a>创建服务提供者实现模块</h2><p>创建一个 <code>user-web-service</code> 的项目 <code>Module</code>  <code>user-web-service</code> ，创建完成后引入 <strong>服务提供者公用模块</strong>的依赖， <code>pom.xml</code> 如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">	&lt;artifactId&gt;user-parent&lt;/artifactId&gt;</span><br><span class="line">	&lt;groupId&gt;com.bsong&lt;/groupId&gt;</span><br><span class="line">	&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">&lt;/parent&gt;</span><br><span class="line">&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">&lt;groupId&gt;com.bsong.user&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;user-web-server&lt;/artifactId&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;com.bsong&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;user-common&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-cloud-starter-feign&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>提供一个RPC的controller、实现上述接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/rpc/user"</span>, produces = MediaType.APPLICATION_JSON_UTF8_VALUE)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserRpcController</span> <span class="keyword">implements</span> <span class="title">UserRpcService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(UserRpcController.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户id查询用户信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findById</span><span class="params">(@PathVariable(name = <span class="string">"uid"</span>, required = <span class="keyword">false</span>)</span> String uid) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.findById(uid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过 <strong>注解</strong> <code>@EnableEurekaClient</code> 表明自己是一个 <code>EurekaClient</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span>(scanBasePackages=&#123;<span class="string">"com.bsong"</span>&#125;)</span><br><span class="line"><span class="meta">@EnableFeignClients</span>(basePackages = <span class="string">"com.bsong"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserWebApplication</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(UserWebApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>到这里 就提供好了RPC接口。别的服务要是直接引用user-common就行。。然后注入这个 就可以直接像调用接口一样使用了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Resource</span><br><span class="line">private UserRpcService userRpcService;</span><br></pre></td></tr></table></figure>
<h1 id="Feign的源码"><a href="#Feign的源码" class="headerlink" title="Feign的源码"></a>Feign的源码</h1><p>总的来说， <code>Feign</code> 的 <strong>源码实现</strong> 过程如下：</p>
<ul>
<li>首先通过 <code>@EnableFeignClients</code> 注解开启 <code>FeignClient</code> 的功能。只有这个 <strong>注解</strong> 存在，才会在程序启动时 <strong>启动</strong> <code>@FeignClient</code> <strong>注解</strong> 的 <strong>包扫描</strong>。</li>
<li><strong>服务提供者</strong> 实现基于 <code>Feign</code> 的 <strong>契约接口</strong>，并在 <strong>契约接口</strong> 上面加上 <code>@FeignClient</code> 注解。</li>
<li><strong>服务消费者</strong> 启动后，会进行 <strong>包扫描</strong> 操作，扫描所有的 <code>@FeignClient</code> 的 <strong>注解</strong> 的类，并将这些信息注入 <code>Spring</code> 上下文中。</li>
<li>当 <strong>接口</strong> 的方法被调用时，通过 <code>JDK</code> 的 <strong>代理</strong> 来生成具体的 <code>RequestTemplate</code> <strong>模板对象</strong>。</li>
<li>根据 <code>RequestTemplate</code> 再生成 <code>HTTP</code> 请求的 <code>Request</code> 对象。</li>
<li><code>Request</code> 对象交给 <code>Client</code> 去处理，其中 <code>Client</code> 内嵌的 <strong>网络请求框架</strong> 可以是 <code>HTTPURLConnection</code>、 <code>HttpClient</code> 和 <code>OkHttp</code>。</li>
<li>最后 <code>Client</code> 被封装到 <code>LoadBalanceClient</code> 类，这个类结合 <code>Ribbon</code> 完成 <strong>负载均衡</strong> 功能。</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/02/rest+ribbon/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sbing">
      <meta itemprop="description" content="你只管努力、剩下的交给天意">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="sbing的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/02/rest+ribbon/" class="post-title-link" itemprop="url">rest+ribbon</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-01-02 17:01:21" itemprop="dateCreated datePublished" datetime="2019-01-02T17:01:21+08:00">2019-01-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-02 10:47:36" itemprop="dateModified" datetime="2019-03-02T10:47:36+08:00">2019-03-02</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/springcloud/" itemprop="url" rel="index"><span itemprop="name">springcloud</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="创建服务提供者"><a href="#创建服务提供者" class="headerlink" title="创建服务提供者"></a>创建服务提供者</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>通过 <strong>注解</strong> <code>@EnableEurekaClient</code> 表明自己是一个 <code>EurekaClient</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">@EnableEurekaClient</span><br><span class="line">@RestController</span><br><span class="line">public class ServiceHiApplication &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(ServiceHiApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>创建一个控制器 <code>HelloController</code>，对外提供一个 <code>/hi</code> 的 <code>HTTP</code> 的服务。在响应数据中返回当前 <strong>服务实例</strong> 的 <strong>端口号</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class HelloController &#123;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;server.port&#125;&quot;)</span><br><span class="line">    private String port;</span><br><span class="line">        </span><br><span class="line">    @RequestMapping(&quot;/hi&quot;)</span><br><span class="line">    public String hi(@RequestParam String name) &#123;</span><br><span class="line">        return &quot;Hi &quot; + name + &quot;, I am from port: &quot; + port;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用上一节的配置文件、将端口改为8763、8764</p>
<p>分别以 <code>spring.profiles.active=hi1</code> 和 <code>spring.profiles.active=hi2</code> 作为 <code>SpringBoot</code> 的 <strong>启动命令参数</strong>，在 <strong>端口号</strong> <code>8763</code> 和 <code>8764</code> 启动 <code>2</code>个 <strong>服务提供者</strong>实例。</p>
<h1 id="创建服务消费者"><a href="#创建服务消费者" class="headerlink" title="创建服务消费者"></a>创建服务消费者</h1><p>重新新建 <code>service-ribbon</code> 的 <code>Module</code>，在它的 <code>pom.xml</code> 文件分别引入 <strong>起步依赖</strong><code>spring-cloud-starter-eureka</code>、 <code>spring-cloud-starter-ribbon</code>、 <code>spring-boot-starter-web</code></p>
<p>在项目的 <strong>配置文件</strong> 指定服务的 <strong>服务注册中心</strong> 的地址，<strong>应用名称</strong> 为 <code>service-ribbon</code>，<strong>端口号</strong> 为 <code>8762</code>。完整配置文件 <code>application.yml</code> 如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">eureka:</span><br><span class="line">    client:</span><br><span class="line">        serviceUrl:</span><br><span class="line">            defaultZone: http://localhost:8761/eureka/</span><br><span class="line">server:</span><br><span class="line">    port: 8762</span><br><span class="line">spring:</span><br><span class="line">    application:</span><br><span class="line">        name: service-ribbon</span><br></pre></td></tr></table></figure>
<p>在应用 <strong>启动类</strong> 上，通过 <code>@EnableDiscoveryClient</code> 向 <strong>服务中心</strong> 注册自身信息，向 <code>SpringBoot</code> 容器注册一个 <code>RestTemplate</code> 对象，并通过 <code>@LoadBalanced</code> 注解表明这个 <code>RestRemplate</code> 开启 <strong>客户端负载均衡</strong> 的功能。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">@EnableDiscoveryClient</span><br><span class="line">public class ServiceRibbonApplication &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(ServiceRibbonApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    @Bean</span><br><span class="line">    @LoadBalanced</span><br><span class="line">    public RestTemplate restTemplate() &#123;</span><br><span class="line">        return new RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>写一个 <strong>测试接口</strong>，注入上面的 <code>RestTemplate</code> 对象来消费 <code>service-hi</code> 服务的 <code>/hi</code> 接口。在 <code>RestTemplate</code> 的 <code>URL</code> 中，我们将具体 <strong>服务生产者</strong> 的 <strong>主机名称</strong>和 <strong>端口号</strong> 替换为它的 <strong>服务名称</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class HelloController &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(value =&quot;/hi&quot;)</span><br><span class="line">    public String requestForHi(@RequestParam String name)&#123;</span><br><span class="line">        return restTemplate.getForObject(&quot;http://SERVICE-HI/hi?name=&quot;+name,String.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在浏览器上多次访问 <code>http://localhost:8762/hi?name=ribbon</code>，浏览器交替显示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Hi ribbon, I am from port: 8763</span><br><span class="line">Hi ribbon, I am from port: 8764</span><br></pre></td></tr></table></figure>
<p>在具体的调用过程中， <code>Ribbon</code> 提供的 <code>@LoadBalanced</code> 注解会从 <code>EurekaServer</code>上查询 <strong>服务列表</strong>，根据 <strong>服务名称</strong> 找到 <code>SERVICE-HI</code> 的 <strong>服务实例</strong>。如果有多个 <code>SERVICE-HI</code> 实例， <code>Ribbon</code> 会根据 <strong>客户端负载均衡</strong> 算法筛选其中一台，并把 <code>URL</code> 中的 <code>SERVICE-HI</code> 替换为具体实例的 <strong>主机名称</strong> 和 <strong>端口号</strong>。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/01/cloud服务注册与服务发现/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sbing">
      <meta itemprop="description" content="你只管努力、剩下的交给天意">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="sbing的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/01/cloud服务注册与服务发现/" class="post-title-link" itemprop="url">服务注册与服务发现</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-01-01 17:01:21" itemprop="dateCreated datePublished" datetime="2019-01-01T17:01:21+08:00">2019-01-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-02 10:47:25" itemprop="dateModified" datetime="2019-03-02T10:47:25+08:00">2019-03-02</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/springcloud/" itemprop="url" rel="index"><span itemprop="name">springcloud</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>springcloud里面的eureka模块来实现 <strong>服务注册和发现</strong>。 <code>Eureka</code>采用了 <code>C-S</code> 的 <strong>设计架构</strong>。 <code>EurekaServer</code> 作为 <strong>服务注册中心</strong>，系统中的 <strong>其他微服务</strong>，使用 <code>Eureka</code> 的 <strong>客户端</strong> 连接到 <code>EurekaServer</code>，并通过 <strong>心跳连接</strong> 检测服务的 <strong>存活状态</strong>。</p>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><p><strong>Eureka Server</strong>: 作为 <strong>服务注册中心</strong>，提供 <strong>服务注册和发现</strong>。</p>
<p><strong>Eureka Client</strong>: 所有注册到 <strong>服务中心</strong> 的服务。</p>
<ul>
<li><p><strong>Service Provider</strong>: 把 <strong>自身的服务</strong> 注册到 <code>EurekaServer</code>，从而使 <strong>服务消费方</strong> 能够找到。</p>
</li>
<li><p><strong>Service Consumer</strong>: 从 <code>EurekaServer</code> 获取 <strong>服务注册列表</strong>，从而能够 <strong>消费服务</strong>。</p>
</li>
</ul>
<p>创建 <code>2</code> 个项目 <code>Module</code>，一个 <code>Module</code>（即 <code>SpringBoot</code>）工程作为 <strong>服务注册中心</strong>，即 <code>EurekaServer</code>，另一个作为 <code>EurekaClient</code>。</p>
<h2 id="创建服务注册中心"><a href="#创建服务注册中心" class="headerlink" title="创建服务注册中心"></a>创建服务注册中心</h2><p><code>EurekaServer</code> 创建完后的工程pom如下（只复制主要的）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-eureka-server&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p><code>application.yml</code> 文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">    port:8761</span><br><span class="line">eureka:</span><br><span class="line">    instance:</span><br><span class="line">        hostname:localhost</span><br><span class="line">    client:</span><br><span class="line">        registerWithEureka:false</span><br><span class="line">        fetchRegistry:false</span><br><span class="line">        serviceUrl:</span><br><span class="line">            defaultZone:http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>eureka.client.register-with-eureka</strong></li>
</ul>
<p>设置是否将自己作为 <code>EurekaClient</code> 注册到 <code>EurekaServer</code>，默认为 <code>true</code>。</p>
<ul>
<li><strong>eureka.client.fetch-registry</strong></li>
</ul>
<p>设置是否从 <code>EurekaServer</code> 获取 <strong>注册信息</strong>，默认为 <code>true</code>。因为本例是一个 <strong>单点</strong> 的 <code>EurekaServer</code>，不需要 <strong>同步</strong> 其他 <code>EurekaServer</code> 节点的数据，所以设置为 <code>false</code>。</p>
<ul>
<li><strong>eureka.client.service-url.defaultZone</strong></li>
</ul>
<p>设置的是与 <code>EurekaServer</code> 的 <strong>交互地址</strong>，<strong>查询</strong> 和 <strong>注册服务</strong> 都依赖这个地址，如果有多个可以使用 <strong>英文逗号分隔</strong>。</p>
<p>然后再把注解 <code>@EnableEurekaServer</code> 加在 <code>SpringBoot</code> 工程的启动类 <code>Application</code> 上面：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@EnableEurekaServer</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class EurekaserverApplication &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(EurekaserverApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>EurekaServer</code> 是有界面的，启动项目后，打开浏览器访问 <code>http://localhost:8761</code> 即可查看。</p>
<h2 id="创建服务提供者"><a href="#创建服务提供者" class="headerlink" title="创建服务提供者"></a>创建服务提供者</h2><p>当一个 <code>EurekaClient</code> 向 <code>EurekaServer</code> 发起 <strong>注册</strong> 时，它会提供一些 <strong>元数据</strong>，例如 <strong>主机</strong> 和 <strong>端口</strong> 等等。 <code>EurekaServer</code> 从每个 <code>EurekaClient</code> 实例接收 <strong>心跳消息</strong>。 如果 <strong>心跳超时</strong>，则通常将该实例从 <code>EurekaServer</code> 中删除。依赖包引用的 是 客户端的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>通过 <strong>注解</strong> <code>@EnableEurekaClient</code> 表明自己是一个 <code>EurekaClient</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">@EnableEurekaClient</span><br><span class="line">@RestController</span><br><span class="line">public class ServiceHiApplication &#123;</span><br><span class="line">    @Value(&quot;$&#123;server.port&#125;&quot;)</span><br><span class="line">    private String port;</span><br><span class="line">    </span><br><span class="line">    public static void main(String[] args) &#123;   </span><br><span class="line">        SpringApplication.run(ServiceHiApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @RequestMapping(&quot;/hi&quot;)</span><br><span class="line">    public String home(@RequestParam String name) &#123;</span><br><span class="line">        return &quot;Hi &quot; + name + &quot;, I am from port: &quot;  + port;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>仅仅 <code>@EnableEurekaClient</code> 是不够的，还需要在 <strong>配置文件</strong> 中注明的 <strong>服务注册中心</strong> 的地址， <code>application.yml</code> 配置文件如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">eureka:</span><br><span class="line">    client:    </span><br><span class="line">        serviceUrl:</span><br><span class="line">            defaultZone: http://localhost:8761/eureka/</span><br><span class="line">server:</span><br><span class="line">    port: 8763</span><br><span class="line">spring:</span><br><span class="line">    application:  </span><br><span class="line">        name: service-hi</span><br></pre></td></tr></table></figure>
<p><code>Eureka</code> <strong>客户端</strong> 需要指明 <code>spring.application.name</code>，用于服务的 <strong>唯一标识</strong>，<strong>服务之间</strong>相互调用会基于这个 <code>name</code>。</p>
<p>启动并访问 <code>EurekaServer</code> 的地址 <code>http://localhost:8761</code>，会发现服务名称为 <code>SERVICE-HI</code>，端口为 <code>7862</code> 的服务，已注册到 <code>EurekaServer</code> 的列表上。</p>
<h2 id="高可用的eureka-server"><a href="#高可用的eureka-server" class="headerlink" title="高可用的eureka-server"></a>高可用的eureka-server</h2><p>在一个 <strong>分布式系统</strong> 中，<strong>服务注册中心</strong> 是最重要的基础部分，必须处于 <strong>可以提供服务</strong> 的状态。为了维持其 <strong>可用性</strong>，使用 <strong>集群</strong> 是很好的解决方案。</p>
<p><code>Eureka</code> 通过节点 <strong>对等注册</strong> 的方式实现 <strong>高可用的部署</strong>，所以只需要为每一个 <code>EurekeServer</code> 配置 <strong>其他可用的</strong> <code>EurekeServer</code> 的 <code>serviceUrl</code>，就能实现高可用部署。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">    profiles:</span><br><span class="line">        active: peer1 #peer2</span><br><span class="line">---</span><br><span class="line">spring:</span><br><span class="line">    profiles: peer1</span><br><span class="line">server:</span><br><span class="line">    port: 8761</span><br><span class="line">eureka:</span><br><span class="line">    instance:</span><br><span class="line">        hostname: localhost  </span><br><span class="line">    client:</span><br><span class="line">        serviceUrl:</span><br><span class="line">            defaultZone: http://localhost:8762/eureka/</span><br><span class="line">---</span><br><span class="line">spring:</span><br><span class="line">    profiles: peer2</span><br><span class="line">server:</span><br><span class="line">    port: 8762</span><br><span class="line">eureka:</span><br><span class="line">    instance:</span><br><span class="line">        hostname: localhost </span><br><span class="line">    client:</span><br><span class="line">        serviceUrl:</span><br><span class="line">            defaultZone: http://localhost:8761/eureka/</span><br></pre></td></tr></table></figure>
<p>更改 <code>EurekaServer</code> 的配置文件，再分别以 </p>
<p><code>spring.profiles.active=peer1</code> 和</p>
<p> <code>spring.profiles.active=peer2</code> 作为参数，</p>
<p>启动两次 <code>EurekaServer</code> 即可。</p>
<p>访问 <code>http://localhost:8761/</code>。可以发现， <code>EurekaClient</code> 已经向 <strong>端口号</strong> 为 <code>8761</code> 的 <code>EurekaServer</code> 发起注册。</p>
<p><strong>服务提供者</strong> 的 <strong>配置文件</strong> 并没有向 <strong>端口号</strong> 为 <code>8762</code> 的 <code>EurekaServer</code> 注册。访问 <code>http://localhost:8762/</code>。可以发现，<strong>服务提供者</strong> 的信息已经向 <code>8762</code> 发起注册了，即 <code>8761</code> 的 <strong>注册信息</strong> 已经同步到 <code>8762</code> 节点。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/15/hexo域名绑定/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sbing">
      <meta itemprop="description" content="你只管努力、剩下的交给天意">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="sbing的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/02/15/hexo域名绑定/" class="post-title-link" itemprop="url">hexo绑定域名</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-02-15 17:01:21" itemprop="dateCreated datePublished" datetime="2018-02-15T17:01:21+08:00">2018-02-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-02-12 15:18:43" itemprop="dateModified" datetime="2019-02-12T15:18:43+08:00">2019-02-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/hexo/" itemprop="url" rel="index"><span itemprop="name">hexo</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>很多同学都不会满足于让其他人用username.github.io这样奇奇怪怪的域名来访问自己的个人博客。<br>花3分钟阅读这篇简明教程，为自己的个人博客绑定一个个性域名吧。</p>
<h1 id="购买个性域名"><a href="#购买个性域名" class="headerlink" title="购买个性域名"></a>购买个性域名</h1><p>我这里是在godaddy上购买的。</p>
<p><img src="/img/hexo1.jpg" alt=""></p>
<h1 id="绑定域名"><a href="#绑定域名" class="headerlink" title="绑定域名"></a>绑定域名</h1><p><img src="/img/hexo2.jpg" alt=""></p>
<p>点击管理NDS、删除默认的并添加以下解析，如图：</p>
<p><img src="/img/hexo3.jpg" alt=""></p>
<p>CNAME的值 就是 博客github的值、例如  user.github.io</p>
<p>A的值 是你的博客站点的ip地址，ip获取方式如下：</p>
<p>用以下指令获取自己博客站点的ip：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping  user.github.io(还是刚才那个值 将得到的IP地址 设置进去)</span><br></pre></td></tr></table></figure>
<p>解析配置好了以后，登录github，进入到博客站点对应的仓库，对域名进行设置：</p>
<p><img src="/img/hexo4.jpg" alt=""></p>
<p>到这儿还没结束，在你的本地博客站点路径下的source文件夹里，创建一个名为<strong>CNAME</strong>的文件（注意要大写），里面写上你之前购买的域名。</p>
<p>另外说一句，在你绑定了新域名之后，原来的你的用户名.github.io并没有失效，而是会自动跳转到你的新域名。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">sbing</p>
              <p class="site-description motion-element" itemprop="description">你只管努力、剩下的交给天意</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives">
                
                    <span class="site-state-item-count">32</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">7</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">8</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">sbing</span>

  

  
</div>



  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.0.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.0"></script>

  <script src="/js/src/motion.js?v=7.0.0"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.0"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.0"></script>



  

  


  <script src="/js/src/bootstrap.js?v=7.0.0"></script>



  



  




  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
